import{AbstractConnector as t}from"@web3-react/abstract-connector";import{ConnectorEvent as e}from"@web3-react/types";function r(t,e){return r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},r(t,e)}function n(t,e){if(null==t)return{};var r,n,o={},u=Object.keys(t);for(n=0;n<u.length;n++)e.indexOf(r=u[n])>=0||(o[r]=t[r]);return o}var o=["activate","onError","throwErrors"],u=["supportedChainIds","connectors","uauth","shouldLoginWithRedirect"];if("undefined"!=typeof window){var i=window;i.UAUTH_VERSION=i.UAUTH_VERSION||{},i.UAUTH_VERSION.WEB3_REACT="2.4.0"}var c=/*#__PURE__*/function(t){var i,c;function a(e){var r;return(r=t.call(this,{supportedChainIds:e.supportedChainIds})||this).options=void 0,r._subConnector=void 0,r._uauth=void 0,r.handleUpdate=function(t){return r.emitUpdate(t)},r.handleDeactivate=function(){return r.emitDeactivate()},r.handleError=function(t){return r.emitError(t)},r.options=e,r}c=t,(i=a).prototype=Object.create(c.prototype),i.prototype.constructor=i,r(i,c),a.registerUAuth=function(t){a.UAuth=t},a.importUAuth=function(){try{var t=function(){if(null==a.UAuth)return Promise.resolve(import("@uauth/js").then(function(t){var e;return null!=(e=null==t?void 0:t.default)?e:t})).then(function(t){a.UAuth=t})}();return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(t){return Promise.reject(t)}};var s,h,l=a.prototype;return l.callbackAndActivate=function(t){try{var e=this;return Promise.resolve(a.importUAuth()).then(function(){function r(){return u(e,i,c)}var u=t.activate,i=t.onError,c=t.throwErrors,a=n(t,o),s=a.url?Promise.resolve(e.uauth.loginCallback(a)).then(function(){}):Promise.resolve(e.uauth.loginCallback()).then(function(){});return s&&s.then?s.then(r):r()})}catch(t){return Promise.reject(t)}},l.activate=function(){try{var t=this;return Promise.resolve(a.importUAuth()).then(function(){var r;function n(n){var o;if(null==r.wallet_type_hint)throw new Error("no wallet type present");if(["web3","injected"].includes(r.wallet_type_hint))t._subConnector=t.options.connectors.injected;else{if("walletconnect"!==r.wallet_type_hint)throw new Error("Connector not supported");t._subConnector=t.options.connectors.walletconnect}return null!=t&&null!=(o=t._subConnector)&&o.on&&(t._subConnector.on(e.Update,t.handleUpdate),t._subConnector.on(e.Deactivate,t.handleDeactivate),t._subConnector.on(e.Error,t.handleError)),Promise.resolve(t._subConnector.activate())}var o=function(e,n){try{var o=Promise.resolve(t.uauth.user()).then(function(t){r=t})}catch(t){return n()}return o&&o.then?o.then(void 0,n):o}(0,function(){if(!t.uauth.fallbackLoginOptions.scope.includes("wallet"))throw new Error('Must request the "wallet" scope for connector to work.');return t.options.shouldLoginWithRedirect?Promise.resolve(t.uauth.login({packageName:"@uauth/web3-react",packageVersion:"2.4.0"})).then(function(){return Promise.resolve(new Promise(function(){})).then(function(){throw new Error("Should never get here.")})}):Promise.resolve(t.uauth.loginWithPopup({packageName:"@uauth/web3-react",packageVersion:"2.4.0"})).then(function(){return Promise.resolve(t.uauth.user()).then(function(t){r=t})})});return o&&o.then?o.then(n):n()})}catch(t){return Promise.reject(t)}},l.deactivate=function(){var t;this._subConnector&&(this.uauth.fallbackLogoutOptions.rpInitiatedLogout||this.uauth.logout({rpInitiatedLogout:!1}),null!=this&&null!=(t=this._subConnector)&&t.removeListener&&(this._subConnector.removeListener(e.Update,this.handleUpdate),this._subConnector.removeListener(e.Deactivate,this.handleDeactivate),this._subConnector.removeListener(e.Error,this.handleError)),this.uauth.logout(),this._subConnector.deactivate())},l.isAuthorized=function(){try{var t=this;return Promise.resolve(t.uauth.user()).then(function(e){var r;return!(!e||"function"!=typeof(null==(r=t.subConnector)?void 0:r.isAuthorized))&&t.subConnector.isAuthorized()})}catch(t){return Promise.reject(t)}},l.getProvider=function(){return this.subConnector.getProvider()},l.getChainId=function(){return this.subConnector.getChainId()},l.getAccount=function(){return this.subConnector.getAccount()},s=a,(h=[{key:"uauth",get:function(){var t=this.options,e=t.uauth,r=n(t,u);if(e)return e;if(this._uauth)return this._uauth;if(null==a.UAuth)throw new Error("Must import UAuth before constructing a UAuth Object");if(!r.clientID||!r.redirectUri)throw new Error("Incomplete constructor options");return this._uauth=new a.UAuth(r),this._uauth}},{key:"subConnector",get:function(){if(null==this._subConnector)throw new Error("no subconnector");return this._subConnector}}])&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(s.prototype,h),Object.defineProperty(s,"prototype",{writable:!1}),a}(t);c.UAuth=void 0;export{c as UAuthConnector};
//# sourceMappingURL=index.module.mjs.map
